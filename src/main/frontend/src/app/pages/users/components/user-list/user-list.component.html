<div class="card mb-5">
  <div class="card-body">
    <div class="filtros-container">
      <h3 class="d-flex justify-content-between" (click)="isCollapsed = !isCollapsed">
        <span>Filtros</span>
        <span>
          <i class="fa" [class.fa-chevron-up]="!isCollapsed" [class.fa-chevron-down]="isCollapsed"></i>
        </span>
      </h3>
      <div [ngbCollapse]="isCollapsed">
        <form [formGroup]="filterForm" class="row g-3">
          <div class="col-md-4">
            <input type="text" class="form-control" placeholder="Nome do Utente" formControlName="fullName">
          </div>
          <div class="col-md-4">
            <input type="text" class="form-control" placeholder="Username" formControlName="username">
          </div>
          <div class="col-md-4">
            <select class="form-select" formControlName="perfil">
              <option value="">Todos os Perfis</option>
              <option value="ADMIN">Administrador</option>
              <option value="TECHNICAL">Técnico</option>
              <option value="USER">Utilizador</option>
            </select>
          </div>
          <div class="col-md-4">
            <input type="date" class="form-control" formControlName="birthdate">
          </div>
          <div class="col-md-4">
            <input type="text" class="form-control" placeholder="Plano de Reabilitação" formControlName="plano">
          </div>
          <div class="col-md-4">
            <input type="text" class="form-control" placeholder="Fisioterapeuta" formControlName="fisioterapeuta">
          </div>

          <!-- Botões de ação -->
          <div class="col-12 d-flex gap-2 justify-content-end mt-3">
            <button type="button" class="btn btn-secondary" (click)="clearFilters()">
              <i class="fa-solid fa-xmark me-2"></i>Limpar Filtros
            </button>
            <button type="button" class="btn btn-primary" (click)="applyFilters()">
              <i class="fa-solid fa-magnifying-glass me-2"></i>Pesquisar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <div class="table-responsive">
      <!-- Loading spinner -->
      <div *ngIf="loading" class="text-center py-4">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>

      <!-- Tabela (mostrada quando não está carregando) -->
      <table class="table table-striped" *ngIf="!loading">
        <thead class="table-dark">
          <tr>
            <th>Nome Completo</th>
            <th>Username</th>
            <th>Perfil</th>
            <th>Data de Nascimento</th>
            <th>Plano de Reabilitação</th>
            <th>Profissional</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of users">
            <td>{{user.fullName}}</td>
            <td>{{user.username }}</td>
            <td>
              @if(user.perfil == 'USER') {
              Utente
              }
              @if(user.perfil == 'ADMIN') {
              Administrador
              }
              @if(user.perfil == 'TECHNICAL') {
              Técnico
              }
            </td>
            <td>{{user.birthdate}}</td>
            <td>{{user.plano? 'Com Plano': 'Sem Plano'}}</td>
            <td>{{user?.fisioterapeuta?.fullName}}</td>
            <td class="d-flex justify-content-center gap-2">
              <button class="btn btn-sm btn-info" (click)="onView.emit(user)">
                <i class="fa-solid fa-eye"></i>
              </button>
              <button class="btn btn-sm btn-warning" (click)="onEdit.emit(user)">
                <i class="fa-solid fa-pen"></i>
              </button>
              <button class="btn btn-sm btn-danger" (click)="onDelete.emit(user)">
                <i class="fa-solid fa-trash"></i>
              </button>
              <button class="btn btn-sm" [ngClass]="user.fullName  ? 'btn-success' : 'btn-secondary'"
                (click)="onStatus.emit(user)">
                <i class="fa-solid" [ngClass]="user.fullName ? 'fa-unlock' : 'fa-lock'"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Mensagem quando não há resultados -->
      <div *ngIf="!loading && users.length === 0" class="text-center py-4">
        <p class="text-muted">Nenhum resultado encontrado</p>
      </div>
    </div>
  </div>
</div>