<div class="">
  <div class="card mb-5">
    <div class="card-body">
      <div class="filtros-container">
        <h3 class="d-flex justify-content-between" (click)="isCollapsed = !isCollapsed">
          <span>Filtros</span>
          <span>
            <i class="fas" [class.fa-chevron-up]="!isCollapsed" [class.fa-chevron-down]="isCollapsed"></i>
          </span>
        </h3>
        <div [ngbCollapse]="isCollapsed">
          <div class="form-group d-flex gap-2 flex-wrap">
            <div class="flex-grow-1">
              <input type="text" class="form-control" [(ngModel)]="filtros.userName" placeholder="Nome do Utilizador">
            </div>
            <div class="flex-grow-1">
              <label class="small mb-1">Data de Criação</label>
              <div class="d-flex gap-2">
                <input type="datetime-local" class="form-control" [(ngModel)]="filtros.creationDateStart">
                <input type="datetime-local" class="form-control" [(ngModel)]="filtros.creationDateEnd">
              </div>
            </div>
            <div class="flex-grow-1">
              <label class="small mb-1">Data de Validade</label>
              <div class="d-flex gap-2">
                <input type="datetime-local" class="form-control" [(ngModel)]="filtros.validityDateStart">
                <input type="datetime-local" class="form-control" [(ngModel)]="filtros.validityDateEnd">
              </div>
            </div>
            <div class="d-flex gap-2 align-items-end">
              <button class="btn btn-primary" (click)="aplicarFiltros()">Aplicar</button>
              <button class="btn btn-secondary" (click)="limparFiltros()">Limpar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="loading" class="loading">Carregando planos...</div>

  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <div class="card">
    <div class="card-body">
      <div class="table-responsive">
        <table *ngIf="!loading && !error" class="table table-striped">
          <thead class="table-dark">
            <tr>
              <th>Utente</th>
              <th>Descrição</th>
              <th>Data de Criação</th>
              <th>Data de Validade</th>
              <th>Estado</th>
              <th>Exercícios</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let plano of planos">
              <td>
                <div class="d-flex flex-column">
                  <span>{{ plano.user.fullName }}</span>
                  <small class="text-muted">{{ plano.user.username }}</small>
                </div>
              </td>
              <td>{{ plano.description }}</td>
              <td>{{ plano.creationDate | date:'dd/MM/yyyy HH:mm' }}</td>
              <td>
                <div class="d-flex align-items-center gap-2">
                  {{ plano.validityDate | date:'dd/MM/yyyy HH:mm' }}
                  <button class="btn btn-sm btn-outline-primary" 
                          (click)="atualizarValidityDate(plano, plano.validityDate)">
                    <i class="fas fa-calendar"></i>
                  </button>
                </div>
              </td>
              <td>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" 
                         [checked]="plano.enabled"
                         (change)="toggleEnabled(plano)">
                </div>
              </td>
              <td>{{ (plano.exercises || []).length }} exercícios</td>
              <td>
                <div class="btn-group">
                  <button class="btn btn-sm btn-outline-primary" 
                          [routerLink]="['/plano', plano.id]"
                          title="Ver detalhes">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-warning"
                          [routerLink]="['/plano', plano.id, 'edit']"
                          title="Editar plano">
                    <i class="fas fa-pencil-alt"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-danger" 
                          (click)="abrirModalDelete(plano)"
                          title="Excluir plano">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>